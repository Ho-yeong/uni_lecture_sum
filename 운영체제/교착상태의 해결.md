# 교착상태의 해결

### 환형대기

- 모든 자원에 대하여 일련의 순서대로 고유번호를 부여하고 앞이나 뒤 어느 한 방향으로만 자원을 요구

### 기아상태

- 프로세스가 사용할 수 없는 자원을 계속 기다리면 교착상태의 발생 우려가 있어서, 교착상태를 예방하기 위하여 자원을 할당했을 때 발생되는 기다림의 결과

---

---

## 교착상태 예방과 회피

### 교착상태 예방 기법

- 교착상태가 발생하지 않도록 시스템을 제어 하는 방법
- 다음 네가지 조건중 하나를 제거 또는 부정함으로써 교착상태 예방이 수행됨
  - 상호배제 부정
  - 점유와 대기 부정
  - 비선점 부정
  - 환형대기 부정

### 1. 상호배제 부정

- 상호배제는 자원을 공유하지 않는 조건을 전제로 함
- 상호배제 부정은 `한번에 여러 개의 프로세스가 공유자원을 사용할 수 있도록 함`

### 2. 점유와 대기 부정

- 프로세스 대기를 없애려면 프로세스가 실행되기 전에 필요한 모든 자원을 할당함
- 프로세스가 `자원을 점유하지 않은 상태에서만 자원을 요청할 수 있도록 함`

### 3. 비선점 부정

- 비선점을 부정하는 전제조건은 이미 할당된 자원에 대해서 선점권을 갖지 않음
- 프로세스가 어떤 다른 자원을 요구할 때, 요청한 자원을 사용 가능한지 검사하여, 사용가능하다면 점유하고 있는 자원을 반납하고 요구한 자원을 사용하기 위하여 대기함

### 4. 환형대기 부정

- 모든 자원에 대하여 일련의 순서대로 고유번호를 부여함
- 각 프로세스는 현재 점유 중인 자원의 고유번호를 기준으로 앞이나 뒤 어느 한 방향으로만 자원을 요구함

## 교착상태 회피 기법

```
교착상태가 발생하지 않는다는 가능성을 두지 않고, 교착상태가 발생하면 피해나가는 방법
```

- 프로세스의 시작 거부
  - 프로세스의 요구로 인해 교착상태가 발생할 수 있다면 프로세스를 시작하지 않음
- 자원할당 거부
  - 프로세스의 요구로 자원을 할당하여 교착상태가 발생할 수 있다면 요청한 자원을 할당하지 않음

> 은행가 알고리즘 (Banker's Algorithm)

- 교착상태 회피기법에 주로 사용되는 알고리즘
- 다익스트라가 제안
- 은행의 모든 고객의 요구가 충족되도록 현금을 할당하는 것과 동일한 기법
- 안전상태란 각 프로세스에게 자원을 할당하여 교착상태가 발생하지 않고 완료되는 상태
- 불안전상태란 교착상태가 발생하는 상태
- 적용조건으로는 자원의 양과 프로세스의 수가 일정해야 함
- 프로세스의 모든 요구를 유한시간 내에 할당해야 함
- 사용자가 자원의 최대 필요량을 시스템에 미리 알려야 함

---

## 교착상태의 탐지와 회복

```
교착상태 발생을 예방하지 못했다면 교착상태가 발생헀는지 검사하는 알고리즘 필요
```

- 교착상태가 발생하였다면 이로부터 회복하기 위한 알고리즘도 필요

## 교착상태 탐지 기법

- 교착상태 발견 알고리즘, 자원할당 그래프 사용

```
쇼사니 (Shoshani)와 코프만(Coffman)이 탐지 알고리즘 제안
```

## 교착상태 회복 기법

- 프로세스 시작 거부
  - 교착상태의 모든 프로세스를 중지 시킴
  - 교착상태의 프로세스를 하나씩 중지 시킴
  - 프로세스를 중지 시키는데 있어서 `최소비용으로 중지시키기 위한 방법`으로 희생자(프로세스)를 선택함

```
희생자 선정 시 고려사항
- 프로세스의 남은 작업 완료시간
- 프로세스들의 우선순위
- 희생시킬 프로세스의 개수
- 프로세스가 사용하는 자원의 형태와 개수
```

- 자원 선점
  - 교착상태의 프로세스가 점유중인 자원을 선점하여 다른 프로세스에게 할당함
  - 자원을 선점하여 다른 프로세스에게 할당하고 난 후 교착상태의 프로세스를 정지시킴
  - 프로세스를 정지시킨 후 재시작 함
  - 우선순위가 낮거나, 수행된 경력이 적거나, 사용되는 자원이 적은 프로세스 등을 위주로 해당 프로세스의 자원을 선점함

---

## 기아상태

```
프로세스가 사용할 수 없는 자원을 계속 기다리면 교착상태의 발생 우려가 있음
```

- 교착상태를 예방하기 위하여 자원을 할당했을 때 발생되는 기다림의 결과

> 식사하는 철학자 문제

### 해결 방법

```
대기중인 프로세스를 발견하고 각 프로세스가 대기한 시간을 조사하고 추적함
```

- 새로운 기아상태를 발견하면 새로운 작업의 시작을 보류함
  - 빈번한 시스템 보류로 인하여 처리량이 감소할 수 있음
