# 객체 포인터와 객체 배열, 객체의 동적 생성 이해

### 객체 포인터

- 객체가 소멸될 때 실행되는 멤버 함수로서 클래스의 이름 앞에 ~를 붙인 이름으로 선언

### C++ 동적 메모리 할당

- C++에서는 new와 delete 연산자를 이용
- new 연산자는 힙 시스템 공간으로부터 메모리를 할당하고
- delete 연산자는 할당받은 메모리를 힙으로 반환

---

---

## 1. 객체 포인터와 객체 배열

### 객체 포인터

```
객체에 대한 포인터
Circle *p;
p = &donut;
```

- C 언어의 포인터와 동일
- 객체의 주소 값을 가지는 변수

```
포인터로 멤버를 접근할 떄
```

- 객체포인터 -> 멤버

```
int main() {
    Circle donut;
    Circle pizza(30);

    // 객체 이름으로 멤버 접근
    cout << donut.getArea() << endl;

    // 객체 포인터로 멤버 접근
    Circle *p;
    p = &donut;
    cout << p -> getArea() << endl; // donut의 getArea() 호출
    cout << (*p).getArea() << endl; // donut의 getArea() 호출

    p = &pizza;
    ...
}
```

### 객체 배열, 생성 및 소멸

```
int n[3]
Circle c[3]
```

- 기본 타입 배열 선언과 형식 동일

#### 객체 배열 선언

1. 객체 배열을 위한 공간 할당
2. 배열의 각 원소 객체마다 생성자 실행
   - c[0]의 생성자, c[1]의 생성자, c[2]의 생성자 실행
   - 매개변수 없는 생성자 호출
   - `매개변수 있는 생성자를 호출할 수 없음`
3. 배열 소멸
   - 배열의 각 객체마다 소멸자 호출
   - 생성의 반대순으로 소멸
     - c[2] -> c[1] -> c[0] 순으로 소멸자 호출

### 객체 배열 생성시 기본 생성자 호출

- 기본생성자 없이 매개변수가 있는 생성자가 있을떄는 컴파일 오류

### 객체 배열 초기화

- 배열의 각 원소 객체당 생성자 지정하는 방법

```
Circle circleArray[3] = { Circle(10), Circle(20), Circle() };
```

### 2차원 배열

```
Circle circles[2][3];
```

---

## 동적 메모리 할당 및 메모리 반환

### 동적 메모리 할당 및 반환

```
정적 할당
```

- 변수 선언을 통해 필요한 메모리 할당
  - 많은 양의 메모리는 배열 선언을 통해 할당

```
동적 할당
```

- 필요한 양이 예측되지 않은 경우, 프로그램 작성시 할당 받을 수 없음
- 실행중에 힙 메모리에서 할당
  - 힙(heap)으로부터 할당
  - 힙은 운영체제가 프로세스의 실행을 시작 시킬 때 동적 할당 공간으로 준메모리 공간

```
C 언어의 동적 메모리 할당: malloc()/ free() 함수 호출
```

```
C++ 의 동적 메모리 할당: new 연산자/ delete 연산자
```

- new 연산자
  - 기본타입 메모리 할당, 배열 할당, 객체 할당, 객체 배열 할당
  - 객체의 동적 생성
    - 힙 메모리로부터 객체를 위한 메모리 할당 요청
  - 객체 할당 시 생성자 호출
- delete 연산자
  - new로 할당 받은 메모리 반환
  - 객체의 동적소멸
    - 소멸자 호출 뒤 객체를 힙에 반환

```
데이터타입 *포인터변수 = new 데이터타입;
delete 포인터 변수;

int *pint = new int; // int 타입의 메모리 동적 할당
char *pChar = new char; // char 타입의 메모리 동적 할당
Circle *pCircle = new Circle(); // Circle 클래스 타입의 메모리 동적 할당

delete pint;
delete pChar;
delete pCircle;
```

### delete 사용 시 주의 사항

- 적절치 못한 포인터로 delete 하면 실행 시간 오류 발생
  - 동적으로 할당 받지 않는 메모리 반환 - 오류
  - 동일한 메모리 두 번 반환 - 오류

### 배열의 동적 할당 및 반환

```
데이터타입 *포인터변수 = new 데이터타입 [배열의 크기];
delete [] 포인터변수;
```

### 동적 할당 메모리 초기화 및 delete 시 유의 사항

```
데이터타입 *포인터변수 = new 데이터타입(초기화);

int *pint = new int(20); // 20으로 초기화된 int 타입 할당
char *pchar = new char('a');
```

- 배열은 동적 할당시 초기화 불가능

- delete시 [] 생략
  - 컴파일 오류는 아니지만 비정상적인 반환
