# 다중 I/O 개념 및 폴링 기법

### 다중 처리 (Multi Processing)

- 작업처리를 위한 별도의 프로세스를 생성하여 처리하는 방법

### 멀티 플렉싱 (Multiplexing)

- 데이터를 처리하는데 있어서 하나의 프로세스가 특정 시간동안 여러 개의 작업을 수행

---

---

## 다중 I/O 개념

### 단일 처리

- 하나의 프로세서가 하나의 작업에 대하여 종료될 때까지 처리
- 싱글처리(Single Process)와 동일
- 여러 개의 작업을 처리하기 위해서는 각각을 순차적으로 처리 (배치: batch 방식)
- I/O: 통신 프로그램(네트워크 및 로컬 IPC)의 경우, 프로세스 간 데이터 입/출력으로 처리

### 단일 처리의 문제점

- 통신 및 I/O의 입/출력 관련 기능 처리 시 `블록킹(Blocking) 현상`에 따른 프로세스 무기한 대기 발생
- 클라이언트 - 서버 간 메시지 송/수신이 비동기적으로 동작할 때, `동시에 양단에서 수신상태에 진입하면 블록킹`

### 다중 처리 (Multi Processing)

- 작업 처리를 위한 별도의 프로세스를 생성하여 처리하는 방식
- 복제(Fork)와 쓰레드(Thread) 방식이 있음
- 비교적 구현이 쉬움

- 복제서버의 경우 별도의 프로세스로 동작하므로 공통 자원의 접근을 위한 공유메모리 기법 등의 로컬 IPC기법이 필요
- I/O 처리별 프로세스를 분류하여 처리하는 것은 비효율적
- 여전히 수신부에서는 블록킹 현상이 발생하며, 그에 따른 프로세스 종료 불가현상 문제 가능

### 멀티 플렉싱 (Multiplexing)

- 데이터를 처리하는데 있어서 `하나의 프로세스`가 특정 시간동안 여러 개의 작업을 수행
- 여러 개의 작업을 처리하기 위한 방법으로 `시분할(TDM: Time Division Multiplex)`과 `이벤트 분할(Event Driven)`이 있음

- 시분할 방식
  - 시간을 슬롯(Slot)이라는 개념으로 분류
  - 슬롯의 크기만큼 각 주어진 일을 처리
- 이벤트 분할 방식
  - 외부의 신호를 인식하여 그 신호에 등록된 일을 처리 (인터럽트 처리)
- 입/출력에 대하여 별도의 처리

---

## 다중 I/O 처리방법 : Poll()

### 함수: Poll()

- 파일 기술자를 이용하여 이벤트를 감지
- 해당 기술자의 입/출력 상태를 모니터링하여 결과를 기록

- 함수 원형

```
#include <poll.h>

int poll(struct pollfd *fds, nfds_t nfds, int timeout)
```

- 인자
  - struct pollfd \*fds
    - 모니터링 하고자 할 파일 기술자 포함 구조체
  - nfds_t nfds
    - 모니터링할 개수
  - int timeout
    - 모니터링 시간 (밀리초)
- 결과 값
  - 성공 시
    - 0 (타임아웃 발생)
    - \> 0 (발생된 이벤트 개수)
  - 실패 시: -1

### 구조체: struct pollfd

- poll() 함수의 파일 기술자 모니터링용 구조체

```
struct pollfd {
  int fd;
  short events;
  short revents;
}
```

- 구조체 멤버

  - int fd: 파일 기술자
  - short events: 모니터링할 이벤트 종류 (OR 연산자를 통한 중복 등록 가능)
  - short revents: 감지된 이벤트 결과값 (poll 함수에 의해 기록)

- 대표적인 이벤트 종류
  - POLLIN: 입력 이벤트 값
    - 0x01
  - POLLPRI: 긴급 입력 이벤트 (OOB 등)
    - 0x02
  - POLLOUT: 쓰기 가능 이벤트
    - 0x04
  - POLLERR: 오류 발생 이벤트
    - 0x08
