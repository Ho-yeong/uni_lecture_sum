# IP

### NAT

- Naetwork Address Translation

### 패킷

- Packet
- 네트워크 계층에서 사용되는 데이터의 기본 단위

---

---

## 1. IP 패킷의 구조

### 1. IP 특성

- 비 신뢰성 (Unreliable)
  - IP 데이터 그램이 목적이에 성공적으로 도달한다는 것을 보장하지 않음
  - 베스트 에포트 (Best Effort) (UDP)
- 비 접속형 (Connectionless)
  - 전달되는 데이터그램에 대해 상태 정보 유지하지 않음
- 주소 지정
  - 각 네트워크 상에 접속해 있는 노드의 주소를 지정해서 데이터를 전송할 목적지 지정
- 경로 지정
  - 패킷을 전송하기 위한 최선을 경로를 지정

### 2. IP 구조

| Header                       | Payload (SDU) |
| ---------------------------- | ------------- |
| 20 ( OPTION == 4 bytes 단위) |               |
| 최대크기 64K bytes           |

- 최대 크기가 크더라도 이더넷에서 잘라서 전송한다 (데이터 링크 계층)

#### 구조

- VER (4 bit)
  - IP의 버전(IPv4: 4 bit, IPv6: 6 bit)
- HLEN (4 bit)
  - 헤더의 크기 (32비트 단위, 최소값은 5(101))
- SERVICE (8 bit)
  - 서비스 클래스의 우선 순위, 지연, 처리율 등 지정 (보통은 0)
- TLENGTH (16 bit)
  - 데이터 그램 전체 길이 (헤더포함, 바이트 단위)
- ID (16 bit)
  - 데이터 그램의 식별을 위한 일련 번호
- FLAGS (3 bit)
  - 미사용 비트, 단편화 금지 비트, 연속 패킷 비트
- OFFSET (13 bit)
  - 단편화의 위치 (8bit 단위)
  - 연속 패킷 비트가 활성화 되어있을때 확인
- TTL (Time To Live) (8 bit)
  - 홉 카운터 값 (라우터를 통과할 때마다 1씩 감소)(최소의 세팅은 255 (8 bit))
  - 라우터의 수에 대한 상한값을 설정하여 데이터 그램의 생존시간을 제한
- TYPE (8 bit)
  - 데이터를 전송하는 상위 프로토콜 계층의 유형
  - TCP: 6, UDP: 17, ICMP: 1
- CHECKSUM (16 bit)
  - 헤더에 대한 16비트 오류 검사 체크섬
  - CRC16 로직 사용
- SOURCE IP ADDRESS (32 bit)
- DESTINATION IP ADDRESS (32 bit)
- OPTIONS (가변 크기)
  - 네트워크 점검 또는 디버깅의 목적을 위한 옵션, 4바이트 단위

---

## 2. IP 주소체계

### 1. IP 목적

- 단일화된 가상적 통신 시스템 제공
- 동일한 방식의 주소체계
- 각 주소는 반드시 독립적(Unique)이어야 함

### 2. IP 주소

- 물리주소(MAC Address)와는 다른 `독립적인 주소`지정 방법
- 32비트의 IP 주소는 전치부(Prefix)와 후치부(suffix)의 두 부분으로 구성
  - 전치부: 네트워크에 할당된 주소
  - 후치부: 컴퓨터(호스트 또는 단말)에 할당된 주소
- IP 주소의 클래스
  - 클래스 주소지정 방법을 선택
  - 클래스 A, B, C -> 단일 전송 (unicast)
  - 클래스 D -> 다중 전송 (multicast)
    - 여러 목적지 호스트들에게 동일한 데이터 그램을 동시 전송
  - 32비트의 주소는 2진수로 표시하고 사용자는 10진수로 표기

| 클래스 | 시작 주소 |
| ------ | --------- |
| A      | 0 ~ 127   |
| B      | 128 ~ 191 |
| C      | 192 ~ 223 |
| D      | 224 ~ 239 |
| E      | 240 ~ 255 |

- NAT (Network Address Translation)
  - 공인된 IP 주소를 갖는 경우에는 포트번호를 변환하는 기법을 사용
  - PAT (Port Address Translation)이라고도 함

### 3. 목적지에 따른 구분

- 유니 캐스트 (Unicast)
  - 호스트와 목적지 간의 하나의 채널로 통신 (단방향)
- 멀티 캐스트 (Multi-cast)
  - 보내는 패킷의 헤더에서 목적지가 호스트들의 집합으로 이루어진 경우
  - 그룹 주소를 이용하여 그룹에 가입
- 브로드 캐스트 (Broadcast)
  - 같은 네트워크에 있는 모든 호스트에게 보내는 경우
  - 주소는 호스트 식별자에 255를 사용
