# 다중 접속 서버

### 포크(fork) 방식

- 프로세스 전체를 복사 (메모리 영역에 복사)

### 쓰레드(thread) 방식

- 프로세스 일부를 복사 (주로 특정 함수 부분만을 복사, 외부 변수가 있는 메모리 공간을 공유)
- 쓰레드 = 경량 프로세스

---

---

## 단일 접속 서버

### 서버의 종류

- Iterative 서버 (단일 접속)
  - 서비스를 한 순간에 하나의 클라이언트에게 제공
  - 대기중인 클라이언트를 차례대로 서비스
- Concurrent 서버 (다중 접속)
  - 서비스를 동시에 여러 클라이언트에게 제공
  - `자기 자신을 복제(fork)하는 방식`
  - 쓰레드를 사용하여 클라이언트당 하나의 쓰레드(Thread)로 처리하는 방식
- Multiplexing 서버 (다중 접속)
  - 서비스를 동시에 여러 클라이언트에게 제공
  - 하나의 서버에서 다수의 클라이언트의 접속을 허용하고 각각을 서비스

### 접속 대기큐 (Waiting Queue)

- 클라이언트 접속 요청을 처리하기 위한 백 로그(Back-log)
- listen() 함수 호출을 통해 대기큐 생성

- 명령어: ss
  - 소켓의 상태를 모니터링 할 수 있는 툴
  - -l : 대기상태(LISTEN)의 소켓을 출력
  - -t : TCP 소켓을 출력
  - -n : 출력의 값을 숫자로 표기
  - -p : 프로세스 정보를 표기

### 특징

- 서버 - 클라이언트 쌍이 한 개 만 존재
- 하나의 클라이언트를 위한 서비스를 수행
- 접속이 되어있는 한 오직 한 개의 클라이언트와 통신
- 모든 서비스가 완료되고 서버-클라이언트간 접속이 종료되기까지 타 클라이언트와의 통신이 불가
- 단일 운영환경에 적합
- 상대적으로 자원을 많이 점유하는 환경에서 운영
- ex) 모니터링 및 관리, 무선공유기 원격 관리, 원격데스크톱 서비스, 네트워크 프린터/스캐너 등

### 장점

- 가장 많이 활용되고 있는 방식
- 상대적으로 구현이 단순
- 보안에 비교적 안정적

### 단점

- 다중 클라이언트 서비스 불가
- 직전 쌍(Pair)간 통신 종료 때까지 대기 필요
- 다중 클라이언트간 정보 공유 불가 (ex) IRC, 공유채팅방 등)

---

## 다중 접속 서버의 종류

- 다수의 클라이언트 접속을 지원
- 접속된 다수의 클라이언트로부터 수신된 요청들을 처리
- 방식에 따라 서버 자신을 `복제 하는 방식`과 `다중 I/O처리 하는 방식`으로 나뉨

### 다중 접속 서버를 위한 소켓용 함수

- 서버 연결대기 함수 listen() 호출 시 최대 접속을 지원할 클라이언트의 개수를 명기
- listen() 함수에서 지정한 개수만큼 클라이언트의 접속 요청을 대기큐에 보관
- 각 대기큐의 요청에 대한 허가는 accept() 함수 호출 시 수행됨
- 다중 접속을 위해서는 각 요청 대기들에 대한 accept()함수를 호출하여 접속을 허가해야 함

### 프로그래밍적 다중 접속에 대한 문제

- 대기큐의 요청을 허가하기 위한 accept()함수가 제때 호출되어야 함
- `accept()함수는 접속 요청에 대한 처리이므로 블록킹(대기)의 특성을 지님`
- write()나 send() 함수대비 recv() 또는 read() 함수는 데이터 수신을 위해 블록킹 됨
- 각 블록킹 현상에 따른 타 작업이 불가한 상태
  - accept() 대기 시간 동안 타 클라이언트와 데이터 송/수신 불가

### Concurrent 방식의 서버

- 주 서버 프로세스는 accept() 함수를 호출하여 항상 대기상태로 진입
- 클라이언트의 접속 요청이 오면 접속을 수락하고 자기 자신을 복제(Clone)
- 프로세스 복제방식은 형태에 따라 포크(fork) 방식과 쓰레드 (thread)방식이 있음

- 포크 방식
  - 프로세스 전체를 복사 (메모리 영역 모두 복사)
- 쓰레드 방식
  - 프로세스의 일부를 복사 (주로 특정 함수 부분만을 복사, 외부 변수가 있는 메모리 공간을 공유)
  - 쓰레드 = 경량 프로세스
- 자식프로세스간의 데이터 공유는 IPC 기법 (메시지큐, 공유 메모리 등)
- 대표적 서버
  - 웹, FTP, TELNET, SSH, SQL 서버 등

### Multiplexing 방식의 서버

- 하나의 서버 프로세스에서 다수의 클라이언트 서비스가 가능
- 블록킹이 발생하는 함수를 호출하기 전 해당 이벤트가 있는지 확인 후 처리
- 해당 이벤트는 소켓 기술자로 등록하여 처리
- `예외상황에 따른 서버 프로세스의 이상(errors)은 모든 연결된 클라이언트에 영향을 줌`
